!function(e,t){if("function"==typeof define&&define.amd)define(["require","lodash"],function(i,n){var s=t(n);return i.specified("khoaijs")&&i(["khoaijs"],function(e){e.EventEmitter=s}),e.EventEmitter=s,s});else{var i=t(e._);e.Khoai&&(e.Khoai.EventEmitter=i),e.EventEmitter=i}}(this,function(e){"use strict";function t(e){return f.hasOwnProperty(e)||(f[e]=0),e+ ++f[e]}function i(){this.id=this.id?this.id:t("event_emitter_"),this._events={},this._listeners={},this._listening={},this._mimics={},this._private_events={}}function n(e,t,i,n){return!!e._listeners.hasOwnProperty(t)&&(!!e._listeners[t].events.hasOwnProperty(i)&&(delete e._listeners[t].events[i][n],!0))}function s(t,i){return e.isNumber(i)&&(i={priority:i}),i=e.defaults(i||{},{priority:500,times:!0,context:null,key:"",async:!1,delay:1})}function r(t,i){var n=[];return e.each(t._listeners,function(e,t){e.listener===i&&n.push(t)}),n}function o(t){return t=e.castArray(t),e.zipObject(t,e.fill(new Array(t.length),!0))}function a(t,i,n){var s;t._events.hasOwnProperty(i)&&(s=l(t,i),s.length&&e.each(s,function(e){if(!0===e.times||e.times>0){if(e.async?y(e.listener,n,e.context||t,e.delay):p(e.listener,n,e.context||t),!0===e.times)return;if(--e.times>0)return void(t._events[i][e.event_index_key].times=e.times)}t.removeListener(e.listener_key,i)}))}function c(t,i){return!0===t._private_events||e.isObject(t._private_events)&&t._private_events.hasOwnProperty(i)}function h(t,i,n){return e.isBoolean(t._mimics)?t._mimics:!(!e.isObject(t._mimics)||!t._mimics.hasOwnProperty(i))||(n?!(!(n=_(t,e.isObject(n)?n.id:n))||!(!0===t._listening[n].mimics||e.isObject(t._listening[n].mimics)&&t._listening[n].mimics.hasOwnProperty(i))):t._mimics.hasOwnProperty(i))}function l(t,i){if(!t._events.hasOwnProperty(i))return[];var n=[];return e.each(t._events[i],function(i,s){t._listeners.hasOwnProperty(i.listener_key)&&(i.listener=t._listeners[i.listener_key].listener,i.event_index_key=s,n.push(e.cloneDeep(i)))}),e.sortBy(n,"priority")}function p(t,i,n){if(i=arguments.length>=2?e.castArray(i):[],t){if(e.isArray(t)){var s=[];return e.each(t,function(e){s.push(e.apply(n||null,i))}),s}if(e.isFunction(t))return t.apply(n||null,i)}}function y(t,i,n,s){return s=parseInt(s),!e.isNaN(s)&&e.isFinite(s)||(s=1),setTimeout(function(){p(t,i,n||null)},Math.max(1,s))}function _(t,i){return t._listening.hasOwnProperty(i)?i:e.findKey(t._listening,["name",i])}function m(t,i,n,s){var r=this;if(t.isListening(r)){var o=t._listening[r.id];if(u(n,o.only,o.except)){var a=Array.prototype.slice.call(arguments,3),c={};c[r.id+"."+n]=!0,c[i+"."+n]=!0,h(t,n,r.id)&&(c[n]=!0),e.each(e.keys(c),function(e){t.emitEvent.apply(t,[e].concat(a))}),t.emitEvent.apply(t,["notified",n].concat(a))}}}function u(e,t,i){return!i.hasOwnProperty(e)&&(!0===t||t.hasOwnProperty(e))}function v(t,i){var n=t._listening[i];n&&(t.emitEvent("before_unlisten",n.target,n),e.isString(n.remove_method)?n.target[n.remove_method](n.listener_key):n.remove_method(n.listener_key),t.emitEvent("unlisten",n.target,n),delete t._listening[i])}var f={};return i.prototype.reset=function(t){t=arguments.length?e.flatten(e.toArray(arguments)):e.keys(this._events);var i=this,s={};return e.each(t,function(t){i._events.hasOwnProperty(t)&&(e.each(i._events[t],function(r,o){n(i,r.listener_key,t,o)&&e.set(s,[r.listener_key,t,o].join("."),!0)}),delete i._events[t])}),e.each(s,function(t,n){e.each(t,function(t,s){i._listeners[n].events[s]=e.omit(i._listeners[n].events[s],e.keys(t)),e.isEmpty(i._listeners[n].events[s])&&delete i._listeners[n].events[s]})}),this},i.prototype.addListener=function(i,n,r){var o,a=this;if(i=e.uniq(e.castArray(i)),r=s(this,r),e.isString(n)){if(!this._listeners.hasOwnProperty(n))throw new Error("Listener is not added");o=n}else o=r.key?r.key:t(this.id+"_listener_"),this._listeners[o]={listener:n,events:{}};return e.each(i,function(t){a._events.hasOwnProperty(t)||(a._events[t]={});var i=a._events[t],n="_"+e.size(i);i[n]=e.extend({},r,{listener_key:o}),a._listeners[o].events.hasOwnProperty(t)||(a._listeners[o].events[t]={}),a._listeners[o].events[t][n]=!0}),o},i.prototype.on=i.prototype.addListener,i.prototype.has=function(t,i){return i=i||e.isUndefined(i),this._listeners.hasOwnProperty(t)&&(!i||!e.isEmpty(this._listeners[t].events))},i.prototype.removeListener=function(t,i){var n,s,o,a=this,c=e.isString(t)?[t]:r(this,t);if(c.length)for(;n=c.shift();)this._listeners.hasOwnProperty(n)&&(s=e.keys(this._listeners[n].events),o=e.isUndefined(i)?s:e.intersection(e.castArray(i),s),e.each(o,function(t){a._events.hasOwnProperty(t)&&(a._events[t]=e.omit(a._events[t],e.keys(a._listeners[n].events[t])),delete a._listeners[n].events[t])}))},i.prototype.removeListeners=function(t,i){var n=this;e.each(t,function(e){n.removeListener(e,i)})},i.prototype.addOnceListener=function(t,i,n){return e.isNumber(n)?n={priority:n}:e.isObject(n)||(n={}),n.times=1,this.addListener(t,i,n)},i.prototype.addListeners=function(t){var i=[],n=this,s=[];return e.isObject(t)&&e.each(t,function(t,n){t=e.castArray(t),e.each(t,function(t){t=e.castArray(t),i.push({name:n,cb:t[0],options:t.length>1?t[1]:{}})})}),e.each(i,function(e){s.push(n.addListener(e.name,e.cb,e.options))}),s},i.prototype.mimic=function(t,i){if(!arguments.length)return void(this._mimics=!0);if(1==arguments.length)return void(e.isBoolean(t)?this._mimics=t:e.isObject(t)&&!e.isArray(t)&&this.isListening(t)?this._listening[_(this,t.id||t)].mimics=!0:(t=e.filter(e.flatten(e.castArray(t)),e.isString),t=o(t),e.isObject(this._mimics)?e.extend(this._mimics,t):this._mimics=t));if(!(i=_(this,e.isObject(i)?i.id:i)))throw new Error("Invalid target");if(e.isBoolean(t)){if(!this.isListening(i))throw new Error("The target is not listening");return void(this._listening[i].mimics=t)}var n=this;t=e.castArray(t),e.each(t,function(t){e.isObject(n._listening[i].mimics)||(n._listening[i].mimics={}),n._listening[i].mimics[t]=!0})},i.prototype.isMimic=function(e,t){return h(this,e,t)},i.prototype.private=function(t){e.isBoolean(t)?this._private_events=!!t||{}:(t=e.filter(e.toArray(arguments),e.isString),e.isObject(this._private_events)||(this._private_events={}),e.extend(this._private_events,o(t)))},i.prototype.emitEvent=function(e,t){t=Array.prototype.slice.call(arguments,1),this._events.hasOwnProperty(e)&&a(this,e,t),this._events.hasOwnProperty("notify")&&!c(this,e)&&a(this,"notify",[e].concat(t)),a(this,e+"_complete",t),"event_emitted"!==e&&a(this,"event_emitted",[e].concat(t))},i.prototype.emit=i.prototype.emitEvent,i.prototype.trigger=i.prototype.emitEvent,i.prototype.emitEventThen=function(e,t,i){i=Array.prototype.slice.call(arguments,2),this.emitEvent.apply(this,[e].concat(i)),t.apply(this,i)},i.prototype.emitThen=i.prototype.emitEventThen,i.prototype.triggerThen=i.prototype.emitEventThen,i.prototype.isListening=function(t,i){var n=e.isObject(t)?t.id:t;return!!(e.isString(n)||e.isNumber(n)&&e.isFinite(n)&&!e.isNaN(n))&&(!this._listening.hasOwnProperty(n)||e.isObject(t)&&this._listening[n].target!==t?(n=_(this,n),!e.isUndefined(n)):!i||u(i,this._listening[n].only,this._listening[n].except))},i.prototype.listen=function(t,i,n){if(!e.isObject(t))throw new Error("Listen target must be an object");if(this.isListening(t))return!0;e.isString(i)||(n=i,i=t.id),e.isArrayLike(n)&&(n={only:o(n)}),n=e.defaults(n||{},{target:t,name:i,only:!0,except:{},async:!0,add_method:"addListener",remove_method:"removeListener",event:"notify",mimics:{}}),e.isBoolean(n.mimics)||(n.mimics=o(n.mimics)),e.isBoolean(n.only)||(n.only=o(n.only)),n.except=o(n.except);var s=this,r=function(){m.apply(this,[s,i].concat(Array.prototype.slice.call(arguments)))},a={async:n.async};if(this.emitEvent("before_listen",t,n),e.isString(n.add_method)?n.listener_key=t[n.add_method](n.event,r,a):n.listener_key=n.add_method(this,t,n,r,a),e.isUndefined(n.listener_key)||e.isNull(n.listener_key))throw new Error("Added listener key received by add method is invalid");return this.emitEvent("listen",t,n),this._listening[t.id]=e.omit(n,["async","add_method","event"]),n.listener_key},i.prototype.unlisten=function(t){arguments.length?(t=e.isObject(t)?t.id:t,this.isListening(t)&&v(this,t)):(e.map(e.keys(this._listening),e.partial(v,this)),this._listening={})},i.isEventEmitter=function(e){return e instanceof i},i});
//# sourceMappingURL=event_emitter.min.js.map
